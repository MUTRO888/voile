# Voile 使用指南

## 概述

Voile 是一个完全在浏览器中运行的 Word 文档图像处理工具。它可以：

1. 从 Word 文档中提取所有图片
2. 对图片应用马赛克处理
3. 将处理后的图片写回原始文档
4. 下载包含所有文档的 ZIP 包

**重要**: 所有操作都在本地浏览器中完成，不会上传任何文件到服务器。

## 详细步骤

### 1. 准备工作

确保你的文件夹结构如下：

```
我的文档/
├── 报告1.docx
├── 报告2.docx
└── 子文件夹/
    └── 报告3.docx
```

**注意事项**:
- 仅支持 `.docx` 格式（Office 2007 及以上）
- 不支持旧版 `.doc` 格式
- 文档中必须包含图片

### 2. 启动应用

在终端中运行：

```bash
npm run dev
```

然后在浏览器中打开 `http://localhost:5174`

### 3. 上传文件夹

有两种方式：

**方式一：拖拽**
1. 将包含 Word 文档的文件夹拖到界面中央的"光之容器"
2. 松开鼠标

**方式二：点击选择**
1. 点击界面中央的"光之容器"
2. 在弹出的文件选择器中选择文件夹
3. 点击"选择"

### 4. 浏览图片

上传成功后，界面会切换到"画廊模式"：

- **背景**: 深邃的炭灰色（暗房模式）
- **中央**: 当前图片
- **底部**: 工具栏

#### 导航方式

1. **键盘导航**:
   - `←` 左箭头：上一张图片
   - `→` 右箭头：下一张图片

2. **鼠标导航**:
   - 点击工具栏的 `←` 和 `→` 按钮

#### 查看信息

工具栏会显示：
- 当前图片来源：`报告1.docx - Image 3`
- 总进度：`Image 34 / 152`

### 5. 应用马赛克

#### 基本操作

1. **选择区域**:
   - 在图片上按住鼠标左键
   - 拖动鼠标创建选择框
   - 选择框会显示为半透明的白色矩形

2. **应用马赛克**:
   - 松开鼠标左键
   - 选中区域立即被像素化
   - 无需额外确认

3. **调整马赛克大小**:
   - 使用工具栏中的滑块
   - 范围：5px - 30px
   - 默认：10px

#### 高级技巧

**多次打码**:
- 可以在同一张图片上多次应用马赛克
- 每次操作都会被记录到历史栈

**精确控制**:
- 马赛克大小越小，打码越细腻
- 马赛克大小越大，打码越明显

### 6. 撤销操作

如果打错了区域，可以撤销：

**方式一：键盘快捷键**
- Mac: `⌘ + Z`
- Windows/Linux: `Ctrl + Z`

**方式二：点击按钮**
- 点击工具栏的"撤销 (⌘Z)"按钮

**注意**:
- 每张图片都有独立的撤销栈
- 可以多次撤销
- 切换到其他图片不会丢失历史记录

### 7. 生成文档

完成所有编辑后：

1. 点击工具栏右侧的"生成并下载"按钮
2. 按钮会显示已修改的图片数量，例如：`生成并下载 (15 张已修改)`
3. 应用开始处理：
   - 界面显示"正在生成文档..."
   - 后台进行文档重组
4. 处理完成后，浏览器会自动下载一个 ZIP 文件
5. 文件名格式：`voile-modified-1234567890.zip`

### 8. 查看结果

1. 解压下载的 ZIP 文件
2. 文件夹结构与原始文件夹完全相同
3. 打开修改过的 Word 文档
4. 确认图片已被正确替换

## 工作原理

### 文档提取阶段

```
Word 文档 (.docx)
    ↓
解压为 ZIP
    ↓
解析 XML 结构
    ↓
提取图片二进制数据
    ↓
转换为 Canvas ImageData
```

### 图像处理阶段

```
用户拖拽选择区域
    ↓
保存当前状态到历史栈
    ↓
应用马赛克算法
    ↓
更新 Canvas
```

### 文档重组阶段

```
按源文档分组图片
    ↓
对每个文档：
  - 加载原始 .docx
  - 替换修改过的图片
  - 生成新的 .docx
    ↓
打包所有文档为 ZIP
    ↓
触发浏览器下载
```

## 常见问题

### Q: 为什么我的文档没有被提取？

A: 可能的原因：
1. 文档格式不是 `.docx`（旧版 `.doc` 不支持）
2. 文档中没有图片
3. 文档已损坏
4. 文档名以 `~$` 开头（临时文件）

### Q: 可以处理多少张图片？

A: 理论上没有限制，但建议：
- 单次处理不超过 200 张图片
- 单个文档不超过 50MB
- 总文件夹大小不超过 500MB

### Q: 处理后的文档会丢失格式吗？

A: 不会。Voile 只替换图片，不修改文档的其他内容：
- 文字格式保持不变
- 页面布局保持不变
- 其他元素（表格、图表等）保持不变

### Q: 可以撤销多少次？

A: 理论上无限次，但受浏览器内存限制。每次操作会保存完整的 ImageData，大图片会占用较多内存。

### Q: 支持哪些浏览器？

A:
- ✅ Chrome 90+
- ✅ Edge 90+
- ✅ Firefox 88+
- ✅ Safari 14+
- ❌ IE（不支持）

### Q: 数据安全吗？

A: 完全安全。所有操作都在本地浏览器中完成：
- 不上传任何文件到服务器
- 不发送任何网络请求（除了加载应用本身）
- 处理完成后，数据会被浏览器自动清理

## 性能优化建议

### 处理大量图片时

1. **分批处理**: 将文档分成多个小批次
2. **关闭其他标签页**: 释放浏览器内存
3. **使用现代浏览器**: Chrome 和 Edge 性能最佳

### 处理大尺寸图片时

1. **适当调整马赛克大小**: 大图片可以使用更大的马赛克块
2. **避免频繁撤销**: 每次撤销都需要恢复完整的图像数据

## 技术细节

### 马赛克算法

Voile 使用的是**平均像素法**：

1. 将选中区域划分为 N×N 的块（N = 马赛克大小）
2. 计算每个块内所有像素的平均颜色
3. 用平均颜色填充整个块

这种方法：
- ✅ 效果自然
- ✅ 性能优秀
- ✅ 可逆性好（通过撤销）

### 文档格式

`.docx` 文件本质上是一个 ZIP 包，包含：

```
document.docx
├── [Content_Types].xml
├── _rels/
├── word/
│   ├── document.xml      # 文档结构
│   ├── media/            # 图片文件
│   │   ├── image1.png
│   │   └── image2.jpg
│   └── ...
└── ...
```

Voile 会：
1. 解压 ZIP
2. 读取 `word/media/` 中的图片
3. 替换修改后的图片
4. 重新打包为 ZIP

## 快捷键参考

| 快捷键 | 功能 |
|--------|------|
| `←` | 上一张图片 |
| `→` | 下一张图片 |
| `⌘Z` / `Ctrl+Z` | 撤销 |
| 鼠标拖拽 | 选择马赛克区域 |

## 故障排除

### 应用无法启动

```bash
# 清理依赖并重新安装
rm -rf node_modules package-lock.json
npm install
npm run dev
```

### 图片提取失败

1. 检查文档格式是否为 `.docx`
2. 尝试用 Word 打开文档，确认图片存在
3. 检查浏览器控制台的错误信息

### 文档生成失败

1. 检查是否有足够的浏览器内存
2. 尝试减少一次处理的图片数量
3. 检查原始文档是否损坏

## 联系与反馈

如有问题或建议，欢迎：
- 提交 GitHub Issue
- 发送 Pull Request
- 联系开发者

---

**享受你的文档处理之旅！** 🎨
